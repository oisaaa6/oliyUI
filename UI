local StarterGui = game:GetService("StarterGui")
local Players = game:GetService("Players")
local VirtualUser = game:GetService("VirtualUser")
local RunService = game:GetService("RunService")
local MarketplaceService = game:GetService("MarketplaceService")
local RbxAnalyticsService = game:GetService("RbxAnalyticsService")
local LocalPlayer = Players.LocalPlayer
local CurrentCamera = workspace.CurrentCamera

StarterGui:SetCore("SendNotification", {
    Title = "正在初始化",
    Text = "开始倒计时",
    Duration = 5,
})
wait(2)

local countdownTexts = {"三", "二", "一"}
for _, text in ipairs(countdownTexts) do
    StarterGui:SetCore("SendNotification", {
        Title = "倒计时",
        Text = text,
        Duration = 5,
    })
    wait(2)
end

print("Anti Afk On")
LocalPlayer.Idled:Connect(function()
    VirtualUser:Button2Down(Vector2.new(0,0), CurrentCamera.CFrame)
    wait(1)
    VirtualUser:Button2Up(Vector2.new(0,0), CurrentCamera.CFrame)
end)

StarterGui:SetCore("SendNotification", {
    Title = "反挂机已自动开启",
    Text = "被踢出服务器的概率已降低",
    Duration = 5,
})
wait(2)

StarterGui:SetCore("SendNotification", {
    Title = "启动成功",
    Text = "您好，" .. LocalPlayer.Name .. "！欢迎使用BP脚本",
    Duration = 5,
})

-- 3. 自适应水印模块
local function createAdaptiveWatermark()
    -- 移除旧水印（避免重复创建）
    local oldWatermark = game.CoreGui:FindFirstChild("AUG_Watermark")
    if oldWatermark then
        oldWatermark:Destroy()
    end

    -- 创建水印UI
    local watermarkGui = Instance.new("ScreenGui")
    watermarkGui.Name = "AUG_Watermark"
    watermarkGui.Parent = game.CoreGui
    watermarkGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    watermarkGui.ResetOnSpawn = false

    local watermarkText = Instance.new("TextLabel")
    watermarkText.Name = "WatermarkText"
    watermarkText.Parent = watermarkGui
    watermarkText.Text = "BP脚本"
    watermarkText.TextColor3 = Color3.fromRGB(255, 255, 255)
    watermarkText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    watermarkText.TextStrokeTransparency = 0.3
    watermarkText.Font = Enum.Font.GothamBold
    watermarkText.BackgroundTransparency = 1
    watermarkText.AnchorPoint = Vector2.new(1, 0)
    watermarkText.Position = UDim2.new(1, -10, 0, 10)
    watermarkText.TextXAlignment = Enum.TextXAlignment.Right

    -- 初始化尺寸（随屏幕自适应）
    local function updateWatermarkSize()
        local screenSize = CurrentCamera.ViewportSize
        watermarkText.TextSize = math.floor(screenSize.Y * 0.02)
        watermarkText.Size = UDim2.new(0, watermarkText.TextBounds.X + 20, 0, watermarkText.TextBounds.Y + 10)
    end
    updateWatermarkSize()

    -- 监听屏幕尺寸变化，实时更新水印
    CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(updateWatermarkSize)
end
createAdaptiveWatermark()

-- 4. FPS与时间显示模块
local LBLG = Instance.new("ScreenGui")
LBLG.Name = "LBLG"
LBLG.Parent = game.CoreGui
LBLG.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
LBLG.Enabled = true

local LBL = Instance.new("TextLabel")
LBL.Name = "LBL"
LBL.Parent = LBLG
LBL.BackgroundColor3 = Color3.new(1, 1, 1)
LBL.BackgroundTransparency = 1
LBL.BorderColor3 = Color3.new(0, 0, 0)
LBL.Position = UDim2.new(0.75, 0, 0.010, 0)
LBL.Size = UDim2.new(0, 133, 0, 30)
LBL.Font = Enum.Font.GothamSemibold
LBL.Text = "TextLabel"
LBL.TextColor3 = Color3.new(1, 1, 1)
LBL.TextScaled = true
LBL.TextSize极 = 14
LBL.TextWrapped = true
LBL.Visible = true

local FpsLabel = LBL
local LastIteration, Start
local FrameUpdateTable = {}

StarterGui:SetCore("SendNotification", {Title = "BP脚本", Text极 = "载入中", Duration = 2})
wait(3)
StarterGui极:SetCore("SendNotification", {Title = "BP脚本", Text = "半缝合", Duration = 2})
wait(2)
StarterGui:SetCore("SendNotification", {Title = "BP脚本", Text = "1", Duration = 2})
wait(2)
StarterGui:SetCore("SendNotification", {Title = "极BP脚本", Text = "载入成功", Duration = 3})

-- 时间更新函数
local function HeartbeatUpdate()
    LastIteration = tick()
    for Index = #FrameUpdateTable, 1, -1 do
        FrameUpdateTable[Index + 1] = (FrameUpdateTable[Index] >= LastIteration - 1) and FrameUpdateTable[Index] or nil
    end
    FrameUpdateTable[1] = LastIteration
    local CurrentFPS = (tick() - Start >= 1 and #FrameUpdateTable) or (#FrameUpdateTable / (tick() - Start))
    CurrentFPS = CurrentFPS - CurrentFPS % 1

    local currentTime = os.date("%H时%M分%S秒")
    FpsLabel.Text = "当前时间：" .. currentTime
end
Start = tick()
RunService.Heartbeat:Connect(HeartbeatUpdate)

-- 5. 功能UI与信息展示模块
local success, xynbui = pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/xcmsnd/QQ515966991/refs/heads/main/Ware_UI%20AL%E9%AB%98%E4%BB%BFV1.0.lua"))()
end)
if not success then
    StarterGui:SetCore("SendNotification", {Title = "错误", Text = "UI脚本加载失败！", Duration = 5})
    warn("UI加载失败：" .. tostring(xynbui))
    return  
end

local win = xynbui:new("BP脚本")

local UITab1 = win:Tab("信息", "16060333448")
local aboutSection1 = UITab1:section("作者信息", false)
aboutSection1:Label("OliyOvO制作")
aboutSection1:Label("更新吃作者")
aboutSection1:Label("忠爱Lutzauto")
aboutSection1:极Label("半缝合")
aboutSection1:Label("谁敢圈钱我给你码杀了")
aboutSection1:Label("感谢游玩")

local UITab2 = win:Tab("作者的感谢", "16060333448")
local aboutSection2 = UITab2:section("作者的感谢", false)
aboutSection2:Label("Lutzauto我爱你")

local aboutSection3 = UITab2:section("你的信息", false)
local executorName = typeof(identifyexecutor) == "function" and identifyexecutor() or "未知注入器"
local characterName = LocalPlayer.Character and LocalPlayer.Character.Name or "角色未加载"

aboutSection3:Label("你的注入器：" .. executorName)
aboutSection3:Label("你的账号年龄：" .. LocalPlayer.AccountAge .. "天")
aboutSection3:Label("你的用户名：" .. LocalPlayer.Name)
aboutSection3:Label("你现在的服务器名称：" .. MarketplaceService:GetProductInfo(game.PlaceId).Name)
aboutSection3:Label("你现在的服务器ID：" .. game.GameId)
aboutSection3:Label("你的用户ID：" .. LocalPlayer.UserId)
aboutSection3:Label("获取客户端ID：" .. RbxAnalyticsService:GetClientId())

aboutSection3:Toggle("脚本框架变小一点", "", false, function(state)
    local frostyUI = game.CoreGui:FindFirstChild("frosty")
    if frostyUI and frostyUI:FindFirstChild("Main") then
        frostyUI.Main.Style = state and "DropShadow" or "Custom"
    end
end)

aboutSection3:Button("关闭脚本", function()
    local frostyUI = game.CoreGui:FindFirstChild("frosty")
    if frostyUI then
        frostyUI:Destroy()
    end
    
    local oldWatermark = game.CoreGui:FindFirstChild("AUG_Watermark")
    if oldWatermark then
        oldWatermark:Destroy()
    end
    local timeUI = game.CoreGui:FindFirstChild("LBLG")
极    if timeUI then
        timeUI:Destroy()
    end
end)

aboutSection3:Label("BP脚本")
aboutSection3:Label("作者QQ：1622103455")
aboutSection3:Button("点击复制作者QQ群", function()
    setclipboard("773406832")
    StarterGui:SetCore("SendNotification", {Title = "复制成功", Text = "QQ群号已复制到剪贴板", Duration = 3})
end)

-- 通用功能标签页
local UITab7 = win:Tab("『脚本』", "773406832")
local commonSection1 = UITab7:section("『BP伐木大亨』", true)
commonSection1:Button("加载BP伐木大亨", function()
    local success, err = pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/oisaaa6/oliyUI/refs/heads/main/UI"))()
    end)
    
    if not success then
        StarterGui:SetCore("SendNotification", {Title = "错误", Text = "BP伐木大亨加载失败：" .. err, Duration = 5})
    end
end)

local commonSection2 = UITab7:section("『BP忍者传奇』", true)
commonSection2:Button("加载BP忍者传奇", function()
    local success, err = pcall(function()
        loadstring(game:HttpGet("极https://raw.githubusercontent.com/oisaaa6/OvOhub/refs/heads/main/Oliyhub"))()
    end)
    
    if not success then
        StarterGui:SetCore("SendNotification", {Title = "错误", Text = "BP忍者传奇加载失败：" .. err, Duration = 5})
    end
end)

-- 无限耐力模块
local StaminaSettings = {
    StaminaLoss = 10,
    StaminaGain = 25,
    InfiniteGain = 9999
}

local bai = {
    Spr = false
}

local connection = nil

local function GetSprintingModule()
    -- 尝试查找常见的体力模块
    local modules = {
        game:GetService("ReplicatedStorage"):FindFirstChild("Sprinting"),
        game:GetService("ReplicatedStorage"):FindFirstChild("StaminaModule"),
        game:GetService("ReplicatedStorage"):FindFirstChild("CharacterModule"),
        game:GetService("Players").LocalPlayer:FindFirstChild("PlayerScripts") and game:GetService("Players").LocalPlayer.PlayerScripts:FindFirstChild("Sprinting"),
        game:GetService("Players").LocalPlayer:FindFirstChild("PlayerScripts") and game:GetService("Players").LocalPlayer.PlayerScripts:FindFirstChild("StaminaModule")
    }
    
    for _, module in ipairs(modules) do
        if module and module:IsA("ModuleScript") then
            return require(module)
        end
    end
    
    -- 如果找不到特定模块，尝试查找本地玩家的体力属性
    if LocalPlayer.Character then
        local humanoid = LocalPlayer.Character:FindFirstChild("Humanoid")
        if humanoid and humanoid:FindFirstChild("Stamina") then
            return {
                StaminaLoss = 10,
                StaminaGain = 25,
                SetStamina = function(value)
                    humanoid.Stamina.Value = value
                end
            }
        end
    end
    
    return nil
end

-- 创建无限耐力UI部分
local UITab19 = win:Tab("游戏功能", "773406832")
local SGV_Tab = UITab19:section("无限耐力", false)

SGV_Tab:Toggle("无限耐力", "开关", false, function(state)
    bai.Spr = state
    local Sprinting = GetSprintingModule()

    if not Sprinting then
        warn("无法找到体力模块!")
        StarterGui:SetCore("SendNotification", {
            Title = "错误",
            Text = "无法找到体力模块，可能不支持此游戏",
            Duration = 5
        })
        return
    end

    if state then
        -- 保存原始设置
        StaminaSettings.StaminaLoss = Sprinting.StaminaLoss or 10
        StaminaSettings.StaminaGain = Sprinting.StaminaGain or 25
        
        -- 应用无限耐力
        Sprinting.StaminaLoss = 0
        Sprinting.StaminaGain = StaminaSettings.InfiniteGain

        if connection then connection:Disconnect() end
        connection = RunService.Heartbeat:Connect(function()
            if not bai.Spr then return end
            Sprinting.StaminaLoss = 0
            Sprinting.StaminaGain = StaminaSettings.InfiniteGain
            
            -- 如果角色有体力属性，保持满体力
            if LocalPlayer.Character then
                local humanoid = LocalPlayer.Character:FindFirstChild("Humanoid")
                if humanoid and humanoid:FindFirstChild("Stamina") then
                    humanoid.Stamina.Value = humanoid.Stamina.MaxValue or 100
                end
            end
        end)
        
        StarterGui:SetCore("SendNotification", {
            Title = "无限耐力",
            Text = "已开启无限耐力功能",
            Duration = 3
        })
    else
        -- 恢复原始设置
        Sprinting.StaminaLoss = StaminaSettings.StaminaLoss
        Sprinting.StaminaGain = StaminaSettings.StaminaGain

        if connection then
            connection:Disconnect()
            connection = nil
        end
        
        StarterGui:SetCore("SendNotification", {
            Title = "无限耐力",
            Text = "已关闭无限耐力功能",
            Duration = 3
        })
    end
end)

-- 添加其他游戏功能
SGV_Tab:Button("重置角色", function()
    local character = LocalPlayer.Character
    if character then
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.Health = 0
        end
    end
end)

SGV_Tab:Button("刷新角色", function()
    LocalPlayer:LoadCharacter()
end)

StarterGui:SetCore("SendNotification", {
    Title = "BP脚本",
    Text = "所有功能加载完成！",
    Duration = 5
})
